'use client';
import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';

export default function SchemaAuditPage() {
    const [schema, setSchema] = useState({ tables: [], loading: true });

    useEffect(() => {
        async function fetchSchema() {
            // We'll attempt to pull one row from each key table to see the keys
            const { data: qKeys } = await supabase.from('questions').select('*').limit(1);
            const { data: mKeys } = await supabase.from('modules').select('*').limit(1);
            const { data: dKeys } = await supabase.from('diagnostic_questions').select('*').limit(1);

            setSchema({
                questions: qKeys?.[0] ? Object.keys(qKeys[0]) : [],
                modules: mKeys?.[0] ? Object.keys(mKeys[0]) : [],
                diagnostic: dKeys?.[0] ? Object.keys(dKeys[0]) : [],
                loading: false
            });
        }
        fetchSchema();
    }, []);

    if (schema.loading) return <div style={{padding: '50px'}}>Reading SQL Blueprints...</div>;

    return (
        <div style={{ padding: '40px', fontFamily: 'sans-serif', lineHeight: '1.6' }}>
            <h1 style={{ color: '#1e40af' }}> SQL Blueprint Alignment</h1>
            <p>Use these keys to format your local JSON files before inflation.</p>
            
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '20px' }}>
                <div style={{ background: '#f8fafc', padding: '20px', borderRadius: '8px', border: '1px solid #cbd5e1' }}>
                    <h3> Questions Table</h3>
                    <ul>{schema.questions.map(k => <li key={k}><code>{k}</code></li>)}</ul>
                </div>
                <div style={{ background: '#f8fafc', padding: '20px', borderRadius: '8px', border: '1px solid #cbd5e1' }}>
                    <h3> Modules Table</h3>
                    <ul>{schema.modules.map(k => <li key={k}><code>{k}</code></li>)}</ul>
                </div>
                <div style={{ background: '#f8fafc', padding: '20px', borderRadius: '8px', border: '1px solid #cbd5e1' }}>
                    <h3> Diagnostic Table</h3>
                    <ul>{schema.diagnostic.map(k => <li key={k}><code>{k}</code></li>)}</ul>
                </div>
            </div>
        </div>
    );
}