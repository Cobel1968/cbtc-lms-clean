'use client';
import React, { useState } from 'react';

export default function OCRVerifyPage() {
    const [preview, setPreview] = useState<string | null>(null);
    const [isAnalyzing, setIsAnalyzing] = useState(false);
    const [metrics, setMetrics] = useState<any>(null);

    const handleVerification = (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (!file) return;

        setIsAnalyzing(true);
        setMetrics(null);

        const reader = new FileReader();
        reader.onload = (event) => {
            setPreview(event.target?.result as string);
            
            // Simulate Cobel AI Engine: Technical extraction and scoring
            setTimeout(() => {
                setMetrics({
                    score: "18.5 / 20",
                    accuracy: "98.7%",
                    termsDetected: ["Atelier (Workshop)", "Sécurité (Safety)", "Maintenance"],
                    fluency: "Technical Mastery",
                    date: new Date().toLocaleDateString()
                });
                setIsAnalyzing(false);
            }, 1800);
        };
        reader.readAsDataURL(file);
    };

    return (
        <div style={{ padding: '40px', background: '#f8fafc', minHeight: '100vh', fontFamily: 'system-ui' }}>
            <h1 style={{ color: '#0f172a', marginBottom: '10px' }}> Analyse de l'Évaluation Technique</h1>
            <p style={{ color: '#64748b', marginBottom: '30px' }}>Verification of Technical Fluency and Handwriting Extraction.</p>

            <div style={{ display: 'grid', gridTemplateColumns: '1.2fr 0.8fr', gap: '30px' }}>
                
                {/* LEFT: IMAGE PROOF */}
                <div style={{ background: '#0f172a', borderRadius: '16px', padding: '20px', display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '500px', border: '1px solid #1e293b' }}>
                    {preview ? (
                        <img src={preview} alt="Evidence" style={{ maxWidth: '100%', maxHeight: '600px', borderRadius: '8px', border: '4px solid #fff' }} />
                    ) : (
                        <div style={{ color: '#475569', textAlign: 'center' }}>
                            <p style={{ fontSize: '40px' }}></p>
                            <p>En attente du scan...</p>
                        </div>
                    )}
                </div>

                {/* RIGHT: SCORE & ACCURACY PANEL */}
                <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                    <div style={{ background: '#fff', padding: '25px', borderRadius: '16px', border: '2px solid #2563eb', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)' }}>
                        <h2 style={{ fontSize: '18px', marginTop: 0 }}>Charger l'Évaluation</h2>
                        <input type="file" onChange={handleVerification} accept="image/*" style={{ width: '100%', marginTop: '10px' }} />
                        {isAnalyzing && <p style={{ color: '#2563eb', fontWeight: 'bold', marginTop: '15px' }}> Extraction des données en cours...</p>}
                    </div>

                    {metrics && (
                        <div style={{ background: '#fff', padding: '25px', borderRadius: '16px', border: '1px solid #e2e8f0', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)' }}>
                            <div style={{ borderBottom: '1px solid #f1f5f9', paddingBottom: '15px', marginBottom: '15px' }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                    <span style={{ fontSize: '14px', color: '#64748b', fontWeight: 'bold' }}>NOTE ATTRIBUÉE</span>
                                    <span style={{ fontSize: '24px', fontWeight: '900', color: '#16a34a' }}>{metrics.score}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: '10px' }}>
                                    <span style={{ fontSize: '14px', color: '#64748b', fontWeight: 'bold' }}>PRÉCISION (ACCURACY)</span>
                                    <span style={{ fontSize: '18px', fontWeight: 'bold', color: '#2563eb' }}>{metrics.accuracy}</span>
                                </div>
                            </div>

                            <div style={{ marginBottom: '15px' }}>
                                <h4 style={{ fontSize: '12px', color: '#64748b', textTransform: 'uppercase', marginBottom: '8px' }}>Termes Techniques Identifiés:</h4>
                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '5px' }}>
                                    {metrics.termsDetected.map((term: string, i: number) => (
                                        <span key={i} style={{ background: '#f1f5f9', color: '#1e293b', padding: '4px 10px', borderRadius: '6px', fontSize: '12px', border: '1px solid #e2e8f0' }}>{term}</span>
                                    ))}
                                </div>
                            </div>

                            <div style={{ background: '#f0fdf4', padding: '12px', borderRadius: '8px', border: '1px solid #bbf7d0' }}>
                                <p style={{ fontSize: '13px', color: '#166534', margin: 0 }}><strong>Verdict:</strong> {metrics.fluency}</p>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}