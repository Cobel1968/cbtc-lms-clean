"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8398:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>d,dynamic:()=>l});var s=t(49303),n=t(88716),o=t(60670),i=t(87070),u=t(83683);let l="force-dynamic";async function d(e){try{let{email:r,password:t}=await e.json();if(!r||!t)return i.NextResponse.json({error:"Identifiants requis pour acc\xc3ƒ\xc2\xa9der \xc3ƒ  CBTC"},{status:400});let a=(0,u.createServerClient)(),{data:s,error:n}=await a.auth.signInWithPassword({email:r,password:t});if(n||!s.user)return i.NextResponse.json({error:"Email ou mot de passe incorrect"},{status:401});let{data:o,error:l}=await a.from("users").select("*").eq("email",r).maybeSingle(),d=o;if(l||!o){let e={id:s.user.id,email:s.user.email,first_name:null,last_name:null,phone:null,role:"student",is_active:!0,avatar_url:null,bio:null},{data:r,error:t}=await a.from("users").insert(e).select("*").single();if(t||!r)return i.NextResponse.json({error:"Erreur lors de la cr\xc3ƒ\xc2\xa9ation du profil utilisateur"},{status:500});d=r}return i.NextResponse.json({data:{token:s.session?.access_token||"",user:{id:d.id,email:d.email,role:d.role,first_name:d.first_name,last_name:d.last_name,created_at:d.created_at}},message:"Connexion CBTC r\xc3ƒ\xc2\xa9ussie ! Redirection..."})}catch(e){return console.error("Login error:",e),i.NextResponse.json({error:"Erreur de connexion"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"D:\\CBTC-FINAL\\cbtc-lms\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:h}=p,g="/api/auth/login/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},83683:(e,r,t)=>{t.d(r,{Ag:()=>s,OQ:()=>n,r4:()=>o});var a=t(37857);let s=()=>{let e="your-supabase-url-here",r="your-anon-key-here";return e&&r?(0,a.eI)(e,r):(0,a.eI)("https://placeholder.supabase.co","placeholder")},n=s(),o=async e=>{let r=s(),{data:t,error:a}=await r.from("users").insert([e]).select().single();return{data:t,error:a}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[8948,7857,5972],()=>t(8398));module.exports=a})();