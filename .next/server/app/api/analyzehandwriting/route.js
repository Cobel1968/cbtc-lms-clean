"use strict";(()=>{var e={};e.id=44,e.ids=[44],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},77001:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>u,dynamic:()=>c});var a=r(49303),i=r(88716),n=r(60670),o=r(1804),l=r(87070);let c="force-dynamic";async function u(e){let t=(0,o.e)(),r=null;try{let{data:{user:s},error:a}=await t.auth.getUser();if(a||!s)return l.NextResponse.json({error:"Unauthorized: Please log in"},{status:401});let{data:i}=await t.from("profiles").select("role, subscription_tier").eq("id",s.id).single(),n=i?.role==="lead_trainer"||i?.role==="admin",o=i?.subscription_tier==="pro"||i?.subscription_tier==="enterprise";if(!n||!o)return l.NextResponse.json({error:"Feature Restricted: Lead Trainer subscription required.",code:"PAYMENT_REQUIRED"},{status:402});let c=await e.json().catch(()=>null);if(!c||!c.imageUrl||!c.userId)return l.NextResponse.json({error:"Missing required fields (imageUrl/userId)"},{status:400});let{imageUrl:u,userId:d}=c,p="L'\xe9tudiant a correctement install\xe9 la cl\xe9 dynamom\xe9trique et v\xe9rifi\xe9 le disjoncteur.",{detected_en:m,detected_fr:g,fluency_score:f,adjustment_minutes:h}=mockOcrExtraction(p),{data:_,error:x}=await t.from("vocational_assessments").insert({user_id:d,image_url:u,raw_ocr_text:p,detected_technical_terms_en:m,detected_technical_terms_fr:g,bilingual_fluency_score:f,suggest_timeframe_adjustment:h}).select().single();if(x)throw Error(`Ingestion Failure: ${x.message}`);r=_.id;let{error:y}=await t.rpc("increment_minutes",{row_id:d,minutes_to_add:h});if(y)throw Error(`Temporal Optimization sync failed: ${y.message}`);let w=!1;if(f>=90)try{w=(await issueCertificate(d,{score:f,terms:m.length})).success}catch(e){console.warn("[Cobel Engine] Certificate issuance delayed:",e)}return l.NextResponse.json({success:!0,message:"Analog-to-Digital bridge complete",data:{score:f,adjustment_minutes:h,ingestion_id:r,certificate_sent:w}})}catch(e){if(console.error("[Cobel Engine Bridge] Fatal Error:",e.message),r){let e=(0,o.e)();await e.from("vocational_assessments").delete().eq("id",r),console.log(`[Rollback] Assessment ${r} removed due to downstream failure.`)}return l.NextResponse.json({error:e.message},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/analyzehandwriting/route",pathname:"/api/analyzehandwriting",filename:"route",bundlePath:"app/api/analyzehandwriting/route"},resolvedPagePath:"D:\\CBTC-FINAL\\cbtc-lms\\app\\api\\analyzehandwriting\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g}=d,f="/api/analyzehandwriting/route";function h(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},1804:(e,t,r)=>{r.d(t,{e:()=>i});var s=r(67721),a=r(71615);function i(){let e=(0,a.cookies)(),t="your-supabase-url-here",r="your-anon-key-here";if(!t||!r)throw Error("Missing Supabase Environment Variables in Server Client");return(0,s.createServerClient)(t,r,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,7857,5972,2855,7721],()=>r(77001));module.exports=s})();