'use client';
import React, { useState } from 'react';
import { supabase } from '@/lib/supabaseClient';

export default function AssessmentUploader({ userId }: { userId: string }) {
    const [uploading, setUploading] = useState(false);
    const [previewUrl, setPreviewUrl] = useState<string | null>(null);
    const [analysis, setAnalysis] = useState<any>(null);

    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (!file) return;

        setUploading(true);
        // Create local preview immediately
        setPreviewUrl(URL.createObjectURL(file));

        // SIMULATED COBEL AI ENGINE INGESTION
        setTimeout(() => {
            setAnalysis({
                status: "Success",
                technical_fluency: "85%",
                terms_identified: ["Atelier", "Ã‰quipement"],
                feedback: "Excellent handwriting clarity. Technical terms correctly identified in both EN/FR."
            });
            setUploading(false);
        }, 2000);
    };

    return (
        <div style={{ padding: '15px', border: '2px dotted #2563eb', borderRadius: '8px' }}>
            <h3 style={{ fontSize: '16px', color: '#2563eb' }}>Analog-to-Digital Bridge</h3>
            <input type="file" onChange={handleFileUpload} accept="image/*" style={{ margin: '10px 0' }} />
            
            {previewUrl && (
                <div style={{ marginTop: '10px' }}>
                    <p style={{ fontSize: '10px' }}>SCAN PREVIEW:</p>
                    <img src={previewUrl} alt="Scan" style={{ width: '100%', borderRadius: '4px', border: '1px solid #ddd' }} />
                </div>
            )}

            {analysis && (
                <div style={{ marginTop: '15px', padding: '10px', background: '#f0fdf4', border: '1px solid #bbf7d0', borderRadius: '6px' }}>
                    <p style={{ fontWeight: 'bold', color: '#166534', margin: 0 }}>AI Analysis Complete:</p>
                    <p style={{ fontSize: '12px', color: '#166534' }}>{analysis.feedback}</p>
                </div>
            )}
        </div>
    );
}