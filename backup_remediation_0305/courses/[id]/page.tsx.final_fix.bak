'use client';
import React, { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient'; 
import AssessmentUploader from '@/components/assessment/assessmentuploader'; 

export default function CourseDetailPage() {
  const params = useParams();
  const [courseData, setCourseData] = useState<any>(null);
  
  const rawId = params?.id || '';
  const noHyphenId = String(rawId).replace(/-/g, '').toLowerCase();
  const staticPath = '/' + noHyphenId + '.html';

  useEffect(() => {
    async function fetchCourse() {
      const { data } = await supabase
        .from('courses')
        .select('*, curriculum')
        .eq('id', rawId)
        .single();
      if (data) setCourseData(data);
    }
    if (rawId) fetchCourse();
  }, [rawId]);

  return (
    <div style={{ height: '100vh', width: '100vw', display: 'flex', flexDirection: 'column', overflow: 'hidden', background: '#f8fafc' }}>
      {/* PROFESSIONAL HEADER */}
      <header style={{ padding: '12px 20px', background: '#0f172a', color: 'white', display: 'flex', justifyContent: 'space-between', alignItems: 'center', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>
        <div style={{ display: 'flex', gap: '20px', alignItems: 'center' }}>
          <button 
            onClick={() => window.location.href = '/student/dashboard'} 
            style={{ background: '#334155', color: 'white', border: 'none', padding: '8px 16px', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', fontWeight: '600' }}
          >
            ‚Üê BACK TO DASHBOARD
          </button>
          <h1 style={{ fontSize: '16px', fontWeight: '700', margin: 0 }}>{courseData?.name_fr || 'Cobel Business Training Center'}</h1>
        </div>
        <div style={{ fontSize: '10px', color: '#94a3b8' }}>ASSET: {noHyphenId}.html</div>
      </header>
      
      <div style={{ flex: 1, display: 'flex', overflow: 'hidden' }}>
        {/* LEFT: STATIC VOCATIONAL CONTENT */}
        <div style={{ width: '70%', height: '100%', background: '#fff' }}>
          <iframe 
            src={staticPath} 
            style={{ width: '100%', height: '100%', border: 'none' }} 
            title="Vocational Content"
          />
        </div>

        {/* RIGHT: AI ADAPTIVE SIDEBAR */}
        <div style={{ width: '30%', padding: '24px', overflowY: 'auto', borderLeft: '1px solid #e2e8f0', background: '#ffffff', display: 'flex', flexDirection: 'column', gap: '24px' }}>
          
          <section>
             <AssessmentUploader userId={courseData?.instructor_id || 'student-user'} />
          </section>
          
          <hr style={{ border: 'none', borderTop: '1px solid #f1f5f9' }} />

          <section>
            <h3 style={{ fontSize: '14px', fontWeight: '800', color: '#1e293b', marginBottom: '12px', textTransform: 'uppercase', letterSpacing: '0.05em' }}>
              Programme Adaptatif
            </h3>
            {courseData?.curriculum?.map((m: any) => (
              <div key={m.module_id} style={{ marginBottom: '12px', padding: '12px', background: '#f8fafc', borderRadius: '8px', border: '1px solid #eef2f6' }}>
                <div style={{ fontSize: '13px', fontWeight: 'bold', color: '#2563eb' }}>{m.title_fr}</div>
                <div style={{ fontSize: '11px', color: '#64748b', fontStyle: 'italic' }}>{m.title_en}</div>
              </div>
            ))}
          </section>
        </div>
      </div>
    </div>
  );
}
