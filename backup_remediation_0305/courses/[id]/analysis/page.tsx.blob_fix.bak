'use client';
import React, { useState } from 'react';
import { useParams, useRouter } from 'next/navigation';

export default function FullAnalysisPage() {
    const params = useParams();
    const router = useRouter();
    const [img, setImg] = useState<string | null>(null);
    const [report, setReport] = useState<any>(null);

    const processFile = (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            setImg(event.target?.result as string);
            setTimeout(() => {
                setReport({
                    grade: "19 / 20",
                    fluency: "Expert",
                    extracted: ["Atelier", "EPI", "Maintenance", "Sécurité"],
                    feedback: "Technical terms identified with 98% accuracy. Bilingual mapping confirmed."
                });
            }, 1000);
        };
        reader.readAsDataURL(file);
    };

    return (
        <div style={{ padding: '40px', maxWidth: '1200px', margin: '0 auto', fontFamily: 'sans-serif' }}>
            <button onClick={() => router.back()} style={{ marginBottom: '20px', padding: '10px 20px', cursor: 'pointer' }}>
                 Retour au Cours
            </button>
            
            <h1 style={{ color: '#2563eb' }}>Bridge Analysis: {params.id}</h1>
            
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '40px', marginTop: '30px' }}>
                {/* LEFT: UPLOADER & RESULTS */}
                <div style={{ background: '#f8fafc', padding: '30px', borderRadius: '15px', border: '1px solid #e2e8f0' }}>
                    <h2>Scanner l'Évaluation</h2>
                    <input type="file" onChange={processFile} accept="image/*" style={{ margin: '20px 0' }} />
                    
                    {report && (
                        <div style={{ marginTop: '20px', background: '#fff', padding: '20px', borderRadius: '10px', border: '2px solid #16a34a' }}>
                            <h3 style={{ color: '#166534', marginTop: 0 }}>Note Attribuée: {report.grade}</h3>
                            <p><strong>Mots Identifiés:</strong> {report.extracted.join(', ')}</p>
                            <p style={{ fontStyle: 'italic', fontSize: '14px' }}>{report.feedback}</p>
                        </div>
                    )}
                </div>

                {/* RIGHT: FULL PREVIEW (PROOF) */}
                <div style={{ background: '#000', padding: '20px', borderRadius: '15px', minHeight: '500px', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>
                    {img ? (
                        <img src={img} alt="Evidence" style={{ maxWidth: '100%', maxHeight: '600px', borderRadius: '8px' }} />
                    ) : (
                        <p style={{ color: '#64748b' }}>L'aperçu de votre travail s'affichera ici.</p>
                    )}
                </div>
            </div>
        </div>
    );
}