'use client';
import React, { useState } from 'react';
import { useParams, useRouter } from 'next/navigation';

export default function FullAnalysisPage() {
    const params = useParams();
    const router = useRouter();
    const [fileType, setFileType] = useState<'image' | 'word' | null>(null);
    const [preview, setPreview] = useState<string | null>(null);
    const [report, setReport] = useState<any>(null);

    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (!file) return;

        setReport(null);
        
        if (file.type === "application/vnd.openxmlformats-officedocument.wordprocessingml.document" || file.name.endsWith('.docx')) {
            setFileType('word');
            setPreview(file.name);
            // Simulate OCR/Text Extraction for Word
            setTimeout(() => {
                setReport({
                    grade: "17 / 20",
                    extracted: ["Technical Workshop", "Maintenance Préventive"],
                    feedback: "Document Word détecté. Analyse textuelle terminée. Lexique bilingue validé."
                });
            }, 1000);
        } else {
            setFileType('image');
            const reader = new FileReader();
            reader.onload = (f) => {
                setPreview(f.target?.result as string);
                setReport({
                    grade: "18.5 / 20",
                    extracted: ["Atelier", "EPI"],
                    feedback: "Image détectée. Analyse manuscrite terminée."
                });
            };
            reader.readAsDataURL(file);
        }
    };

    return (
        <div style={{ padding: '40px', maxWidth: '1200px', margin: '0 auto', fontFamily: 'sans-serif' }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '30px' }}>
                <button onClick={() => router.back()} style={{ padding: '10px 20px' }}> Retour</button>
                <h1 style={{ color: '#2563eb' }}>Pont d'Analyse Multi-Format</h1>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '30px' }}>
                <div style={{ background: '#f8fafc', padding: '25px', borderRadius: '15px', border: '1px solid #e2e8f0' }}>
                    <h2>Source: {fileType === 'word' ? 'MS Word Document' : 'Image/Scan'}</h2>
                    <input type="file" onChange={handleFileUpload} style={{ margin: '20px 0' }} />
                    
                    {report && (
                        <div style={{ background: '#fff', padding: '20px', borderRadius: '10px', border: '2px solid #16a34a' }}>
                            <h3 style={{ color: '#166534' }}>Note: {report.grade}</h3>
                            <p><strong>Termes:</strong> {report.extracted.join(', ')}</p>
                            <p style={{ fontStyle: 'italic' }}>{report.feedback}</p>
                        </div>
                    )}
                </div>

                <div style={{ background: '#0f172a', padding: '40px', borderRadius: '15px', display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '400px' }}>
                    {fileType === 'image' && preview && (
                        <img src={preview} alt="Evidence" style={{ maxWidth: '100%', borderRadius: '8px', border: '4px solid #fff' }} />
                    )}
                    {fileType === 'word' && (
                        <div style={{ textAlign: 'center', color: '#fff' }}>
                            <div style={{ fontSize: '60px' }}></div>
                            <p style={{ marginTop: '10px' }}>{preview}</p>
                            <p style={{ color: '#64748b', fontSize: '12px' }}>Analyse textuelle en cours sur le fichier Word...</p>
                        </div>
                    )}
                    {!preview && <p style={{ color: '#475569' }}>En attente de fichier...</p>}
                </div>
            </div>
        </div>
    );
}